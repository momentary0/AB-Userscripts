// ==UserScript==
// @name         TFM's torrent highlighter
// @namespace    TheFallingMan
// @version      0.1.0
// @description  Adds attributes to torrent links, allowing CSS styling.
// @author       TheFallingMan
// @icon         https://animebytes.tv/favicon.ico
// @match        https://animebytes.tv/*
// @license      GPL-3.0
// ==/UserScript==

!function(e){var t={};function __webpack_require__(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:false,exports:{}};return e[n].call(r.exports,r,r.exports,__webpack_require__),r.l=true,r.exports}__webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.d=function(e,t,n){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{configurable:false,enumerable:true,get:n})},__webpack_require__.r=function(e){Object.defineProperty(e,"__esModule",{value:true})},__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=0)}([function(e,t,n){"use strict";var r=function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false,r.configurable=true,"value"in r&&(r.writable=true),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}();function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true}):e[t]=n,e}
// @license      GPL-3.0
!function(){var e,t,n,i,a,s=function(){function TorrentPropertyParser(e,t){!function(e,t){if(!(e instanceof TorrentPropertyParser))throw new TypeError("Cannot call a class as a function")}
// @license      GPL-3.0
(this),this.linkElement=e,this.delim=t,this.spanTemplate=document.createElement("span"),this.spanTemplate.className="userscript-highlight torrent-field",this.docFrag=document.createDocumentFragment()}return r(TorrentPropertyParser,[{key:"parse",value:function(){this.fields=[],this.index=0,this.handlers={},this.nodeAppended=false;for(var e=d.INITIALISE,t=void 0;e;){(t=this.handlers[e])||(t=O[e]);try{e=t.call(this)}catch(e){throw console.error(e),e}this.index>=this.fields.length&&e!==d.FINISHED&&(e=O[d.INSERT_DOCFRAG].call(this))}}},{key:"getNext",value:function(){return this.fields[this.index++]}},{key:"peekNext",value:function(){return this.fields[this.index]}},{key:"newSpan",value:function(e,t,n){this.linkElement.dataset[t]=n;var r=this.spanTemplate.cloneNode(false);return r.dataset[t]=n,e.nodeType?(this.nodeAppended=true,r.appendChild(e)):r.textContent=e,r}},{key:"appendSpan",value:function(e,t,n){this.docFrag.appendChild(this.newSpan(e,t,n))}},{key:"appendText",value:function(e){this.docFrag.appendChild(document.createTextNode(e))}},{key:"appendDelim",value:function(){this.docFrag.appendChild(document.createTextNode(this.delim))}},{key:"clearChildren",value:function(){for(;this.linkElement.hasChildNodes();)this.linkElement.removeChild(this.linkElement.lastChild)}}]),TorrentPropertyParser}();function newCaptureHandler(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function(){return n&&this.appendDelim(),this.appendSpan(this.peekNext(),e,this.peekNext()),this.index++,t}}function newFlagHandler(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return function(){var i=this.peekNext();if(e===i)this.index++,this.appendDelim(),this.appendSpan(i,t,"");else if(null!==r)return r;return n}}function newListHandler(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return function(){var i=this.peekNext();if(-1!==e.indexOf(i))this.index++,this.appendDelim(),this.appendSpan(i,t,i);else if(null!==r)return r;return n}}for(var d=Object.freeze({INITIALISE:-11,DETECTING:-1,BEGIN:-2,COMMON_TRAILING_FIELDS:-3,INSERT_DOCFRAG:-5,FINISHED:false,ERROR:-10}),p=Object.freeze({ENCODING:1,BITRATE:2,SOURCE:3,LOG:4,CUE:5}),l=(_defineProperty(e={},d.BEGIN,newCaptureHandler("encoding",p.BITRATE,false)),_defineProperty(e,p.BITRATE,newCaptureHandler("bitrate",p.SOURCE)),_defineProperty(e,p.SOURCE,newCaptureHandler("source",p.LOG)),_defineProperty(e,p.LOG,newFlagHandler("Log","log",p.CUE)),_defineProperty(e,p.CUE,newFlagHandler("Cue","cue",d.COMMON_TRAILING_FIELDS)),e),o=Object.freeze({SOURCE:1,CONTAINER:2,ASPECT_RATIO:3,VIDEO_CODEC:4,RESOLUTION:5,AUDIO_CODEC_AND_CHANNELS:6,DUAL_AUDIO:7,SUBBING_AND_GROUP:8,REMASTER:9,TRAILING_FIELDS:10}),h=(_defineProperty(t={},d.BEGIN,newCaptureHandler("source",o.CONTAINER,false)),_defineProperty(t,o.CONTAINER,function(){var e=this.getNext();if(")"===e.charAt(e.length-1)){var t=e.substr(0,e.indexOf(" (")),n=e.slice(e.indexOf(" (")+2,-1);return this.appendDelim(),this.appendSpan(t,"container",t),this.appendText(" ("),this.appendSpan(n,"region",n),this.appendText(")"),o.ASPECT_RATIO}return this.appendDelim(),this.appendSpan(e,"container",e),o.VIDEO_CODEC}),_defineProperty(t,o.ASPECT_RATIO,function(){var e=this.getNext();return this.appendDelim(),this.appendSpan(e,"aspectRatio",e),"DVD5"===this.fields[0]||"DVD9"===this.fields[0]?o.RESOLUTION:o.VIDEO_CODEC}),_defineProperty(t,o.VIDEO_CODEC,newCaptureHandler("codec",o.RESOLUTION)),_defineProperty(t,o.RESOLUTION,newCaptureHandler("resolution",o.AUDIO_CODEC_AND_CHANNELS)),_defineProperty(t,o.AUDIO_CODEC_AND_CHANNELS,function(){var e=this.getNext(),t=e.substr(0,e.lastIndexOf(" ")),n=e.substr(e.lastIndexOf(" ")+1);return"."!==n.charAt(1)?d.ERROR:(this.appendDelim(),this.appendSpan(t,"audioCodec",t),this.appendText(" "),this.appendSpan(n,"audioChannels",n),o.DUAL_AUDIO)}),_defineProperty(t,o.DUAL_AUDIO,newFlagHandler("Dual Audio","dualAudio",o.REMASTER)),_defineProperty(t,o.REMASTER,function(){var e=this.peekNext();return"IMG"===e.tagName&&"Remastered"===e.alt&&(this.index++,this.appendDelim(),this.appendSpan(e,"remastered","")),o.SUBBING_AND_GROUP}),_defineProperty(t,o.SUBBING_AND_GROUP,function(){if(u.call(this))return d.COMMON_TRAILING_FIELDS;var e=this.getNext();if(!e.nodeType){var t=(e=e.trim()).substr(0,e.indexOf(" "));if("Softsubs"===t||"Hardsubs"===t||"RAW"===t){this.appendDelim(),this.appendSpan(t,"subbing",t),this.appendText(" (");for(var n=e.substr(e.indexOf(" (")+2);!n.endsWith(")")&&this.index<this.fields.length;)n+=this.delim,n+=this.getNext();n=n.substr(0,n.length-1),this.appendSpan(n,"group",n),this.appendText(")")}return d.COMMON_TRAILING_FIELDS}}),t),u=newListHandler(["Softsubs","Hardsubs","RAW"],"subbing",true,false),c=(_defineProperty(n={},d.BEGIN,newCaptureHandler("type",2,false)),_defineProperty(n,2,newCaptureHandler("platform",3)),_defineProperty(n,3,newListHandler(["Region Free","NTSC-J","NTSC-U","PAL","JPN","ENG","EUR"],"region",4)),_defineProperty(n,4,newListHandler(["Archived","Unarchived"],"archived",5)),_defineProperty(n,5,newFlagHandler("Scene","scene",d.COMMON_TRAILING_FIELDS)),n),f=Object.freeze({TRANSLATION:1,FORMAT:2,ONGOING:4}),_=(_defineProperty(i={},d.BEGIN,function(){var e=this.getNext();if(-1!==e.indexOf("  (")){var t=e.substr(0,e.indexOf("  (")),n=e.slice(e.indexOf("  (")+3,-1);this.appendSpan(t,"translation",t),this.appendText(" ("),this.appendSpan(n,"group",n),this.appendText(")")}else{var r=e.replace(" ","");this.appendSpan(r,"translation",r)}return f.FORMAT}),_defineProperty(i,f.FORMAT,newListHandler(["Archived Scans","EPUB","PDF","Unarchived","Digital"],"format",f.ONGOING)),_defineProperty(i,f.ONGOING,newFlagHandler("Ongoing","ongoing",d.COMMON_TRAILING_FIELDS)),i),N={"Blu-ray":h,Web:h,TV:h,DVD:h,"UHD Blu-ray":h,DVD5:h,DVD9:h,"HD DVD":h,VHS:h,VCD:h,LD:h,MP3:l,FLAC:l,AAC:l,Game:c,Patch:c,DLC:c,Raw:_,Translated:_},O=(_defineProperty(a={},d.INITIALISE,function(){this.oldNodes=this.linkElement.childNodes;for(var e=0;e<this.oldNodes.length;e++){var t=this.oldNodes[e];if(t.nodeType===Node.TEXT_NODE)if(-1!==t.nodeValue.indexOf(this.delim)){var n=t.nodeValue;0===e&&("»"===n.charAt(0)&&(n=n.replace("»",""),this.appendText("» ")),n=n.replace(/^\s+/,""));for(var r=n.split(this.delim),i=0;i<r.length;i++)r[i]&&this.fields.push(r[i])}else this.fields.push(t.nodeValue.trim());else this.fields.push(t)}var a=this.fields[this.fields.length-1];return"string"==typeof a&&a.endsWith(" - Snatched")&&(this.fields[this.fields.length-1]=a.substr(0,a.length-11),this.fields.push(" - Snatched")),d.DETECTING}),_defineProperty(a,d.DETECTING,function(){var e=this.peekNext(),t=N[e];if(void 0!==t)this.handlers=t;else{var n=e.substr(0,e.indexOf(" "));if(this.handlers=N[n],void 0===this.handlers)return this.handlers={},console.info("No first field match for: x"+e+"x"),d.ERROR}return d.BEGIN}),_defineProperty(a,d.ERROR,function(){if(this.nodeAppended){this.clearChildren();for(var e=0;e<this.oldNodes.length;e++)this.linkElement.appendChild(this.oldNodes[e])}return d.FINISHED}),_defineProperty(a,d.COMMON_TRAILING_FIELDS,function(){var e=this.peekNext();if(!e)return d.INSERT_DOCFRAG;switch(e.nodeType){case Node.ELEMENT_NODE:switch(this.appendDelim(),this.index++,e.tagName.toUpperCase()){case"IMG":if("Freeleech!"===e.alt)this.appendSpan(e,"freeleech","");else switch(e.src.substr(e.src.lastIndexOf("/")+1)){case"hentaic.png":this.appendSpan(e,"hentai","Censored");break;case"hentai.png":this.appendSpan(e,"hentai","Uncensored")}break;case"FONT":"Exclusive!"===e.textContent&&this.appendSpan(e,"exclusive","");break;default:this.appendSpan(e,"misc",e.textContent||"")}return d.COMMON_TRAILING_FIELDS;default:return this.index++,-1!==e.indexOf("- Snatched")?(this.appendText(" - "),this.appendSpan("Snatched","snatched","")):(this.appendDelim(),this.appendSpan(e,"misc",e)),d.COMMON_TRAILING_FIELDS}}),_defineProperty(a,d.INSERT_DOCFRAG,function(){return this.clearChildren(),this.linkElement.appendChild(this.docFrag),d.FINISHED}),a),E=document.querySelectorAll('.group_torrent>td>a[href*="&torrentid="]'),I=new s,C=0;C<E.length;C++){var T=E[C];T.classList.add("userscript-highlight"),T.classList.add("torrent-page"),I.linkElement=T,I.delim=-1!==T.href.indexOf("torrents.php")?" | ":" / ",I.parse()}for(var D=document.querySelectorAll('.torrent_properties>a[href*="&torrentid="]'),S=0;S<D.length;S++)D[S].className+="userscript-highlight torrent-page",I.linkElement=D[S],I.delim=" | ",I.parse();for(var g=document.querySelectorAll(':not(.group_torrent)>:not(.torrent_properties)>a[href*="&torrentid="]:not([title])'),m=0;m<g.length;m++){var A=g[m];A.classList.add("userscript-highlight"),A.classList.add("torrent-bbcode");var x=A.firstChild,v=-1!==A.href.indexOf("torrents.php");I.linkElement=A,I.delim=v?" | ":" / ";var R=x.nodeValue.trim(),y=R.indexOf("  ["),b=document.createDocumentFragment();if(-1!==y){var P=R.substr(0,y),L=R.substr(y+3,4),w=v?P.lastIndexOf(" - "):P.indexOf(" - "),k=P.substr(0,w),G=P.substr(w+3);b.appendChild(I.newSpan(k,v?"title":"artist",k)),b.appendChild(document.createTextNode(" - ")),b.appendChild(I.newSpan(G,v?"type":"album",G)),b.appendChild(document.createTextNode("  [")),b.appendChild(I.newSpan(L,"year",L)),b.appendChild(document.createTextNode("] [")),"]"===R.charAt(R.length-1)?x.nodeValue=R.substr(0,R.length-1):(x.nodeValue=R+" ",A.removeChild(A.lastChild)),x.splitText(P.length+10),A.removeChild(x),I.parse(),A.insertBefore(b,A.firstChild),-1!==y&&A.appendChild(document.createTextNode("]"))}}}()}]);
//# sourceMappingURL=tfm_torrent_highlighter.min.user.js.map